unit DVIW_dmdata;

interface

uses
  Forms,
  SysUtils, Classes, FMTBcd, DB, SqlExpr, DBClient, Provider,
  DBXCommon,   midaslib,
  IWCompListbox, WideStrings, DBXDevartInterBase,
  UCustomFlexCelReport, UFlexCelReport, UExcelAdapter, XLSXAdapter;

type
  TdmdDV = class(TDataModule)
    sqlcDateView: TSQLConnection;
    Querydm: TSQLQuery;
    dspQuery2: TDataSetProvider;
    cdsQuerydm: TClientDataSet;
    dsQuerydm: TDataSource;
    dsQdmSmp: TDataSource;
    QuerydmCOUNTRYABR: TStringField;
    QuerydmUNITNAME: TStringField;
    QuerydmMATERIALABR: TStringField;
    QuerydmISOTOPESYSTEM: TStringField;
    QuerydmAPPROACHABR: TStringField;
    QuerydmTECHABR: TStringField;
    QuerydmINTERPABR: TStringField;
    QuerydmPREFLEVEL: TSmallintField;
    QuerydmIAGE: TIntegerField;
    QuerydmIAGEPERROR: TIntegerField;
    QuerydmIAGEMERROR: TIntegerField;
    QuerydmAGEUNITS: TStringField;
    QuerydmLITHOLOGY: TStringField;
    QuerydmMETHODABR: TStringField;
    QuerydmRECORDID: TIntegerField;
    QuerydmCONFIDENTIAL: TIntegerField;
    QuerydmRAGE: TFloatField;
    QuerydmRAGEPERROR: TFloatField;
    QuerydmRAGEMERROR: TFloatField;
    cdsQuerydmCOUNTRYABR: TStringField;
    cdsQuerydmUNITNAME: TStringField;
    cdsQuerydmMATERIALABR: TStringField;
    cdsQuerydmISOTOPESYSTEM: TStringField;
    cdsQuerydmAPPROACHABR: TStringField;
    cdsQuerydmTECHABR: TStringField;
    cdsQuerydmINTERPABR: TStringField;
    cdsQuerydmPREFLEVEL: TSmallintField;
    cdsQuerydmIAGE: TIntegerField;
    cdsQuerydmIAGEPERROR: TIntegerField;
    cdsQuerydmIAGEMERROR: TIntegerField;
    cdsQuerydmAGEUNITS: TStringField;
    cdsQuerydmLITHOLOGY: TStringField;
    cdsQuerydmMETHODABR: TStringField;
    cdsQuerydmRECORDID: TIntegerField;
    cdsQuerydmCONFIDENTIAL: TIntegerField;
    cdsQuerydmRAGE: TFloatField;
    cdsQuerydmRAGEPERROR: TFloatField;
    cdsQuerydmRAGEMERROR: TFloatField;
    QdmSmp: TSQLQuery;
    dsQuerydmDB: TDataSource;
    QdmSmpRECORDID: TIntegerField;
    QdmSmpISOSYSTEM: TStringField;
    QdmSmpSAMPLENO: TStringField;
    QdmSmpFRAC: TStringField;
    QdmSmpINCLUDED: TStringField;
    cdsQdmSmp: TClientDataSet;
    cdsQdmSmpRECORDID: TIntegerField;
    cdsQdmSmpISOSYSTEM: TStringField;
    cdsQdmSmpSAMPLENO: TStringField;
    cdsQdmSmpFRAC: TStringField;
    cdsQdmSmpINCLUDED: TStringField;
    qVariables: TSQLQuery;
    qVariablesVARIABLEABR: TStringField;
    qVariablesVARIABLENAME: TStringField;
    dspVariables: TDataSetProvider;
    cdsVariables: TClientDataSet;
    dsVariables: TDataSource;
    cdsVariablesVARIABLEABR: TStringField;
    cdsVariablesVARIABLENAME: TStringField;
    cdsTable1: TClientDataSet;
    qIsoModels: TSQLQuery;
    dspIsoModels: TDataSetProvider;
    cdsIsoModels: TClientDataSet;
    dsIsoModels: TDataSource;
    qIsoModelsMODELID: TStringField;
    qIsoModelsISOSYSTEM: TStringField;
    qIsoModelsMODELPARAM1: TFloatField;
    qIsoModelsMODELPARAM2: TFloatField;
    qIsoModelsMODELPARAM3: TFloatField;
    qIsoModelsMODELPARAM4: TFloatField;
    qIsoModelsMODELPARAM5: TFloatField;
    qIsoModelsMODELNAME: TStringField;
    qIsoModelsISOSYSTEMNAME: TStringField;
    cdsIsoModelsMODELID: TStringField;
    cdsIsoModelsISOSYSTEM: TStringField;
    cdsIsoModelsMODELPARAM1: TFloatField;
    cdsIsoModelsMODELPARAM2: TFloatField;
    cdsIsoModelsMODELPARAM3: TFloatField;
    cdsIsoModelsMODELPARAM4: TFloatField;
    cdsIsoModelsMODELPARAM5: TFloatField;
    cdsIsoModelsMODELNAME: TStringField;
    cdsIsoModelsISOSYSTEMNAME: TStringField;
    qSmpData: TSQLQuery;
    cdsSmpData: TClientDataSet;
    dsSmpData: TDataSource;
    cdsSmpDataSAMPLENO: TStringField;
    cdsSmpDataFRAC: TStringField;
    cdsSmpDataISOSYSTEM: TStringField;
    cdsSmpDataVARIABLEID: TStringField;
    cdsSmpDataDATAVALUE: TFloatField;
    cdsSmpDataNORMALISINGFACTOR: TFloatField;
    cdsSmpDataNORMALISINGSTANDARD: TStringField;
    qStandards: TSQLQuery;
    qStandardValues: TSQLQuery;
    qStandardsSTANDARDID: TStringField;
    qStandardsSTANDARDNAME: TStringField;
    qStandardValuesSTANDARDID: TStringField;
    qStandardValuesVARIABLEID: TStringField;
    qStandardValuesACCEPTEDVALUE: TFloatField;
    qStandardValuesSTANDARDNAME: TStringField;
    dspStandards: TDataSetProvider;
    cdsStandards: TClientDataSet;
    dsStandards: TDataSource;
    dspStandardValues: TDataSetProvider;
    cdsStandardValues: TClientDataSet;
    dsStandardValues: TDataSource;
    cdsStandardsSTANDARDID: TStringField;
    cdsStandardsSTANDARDNAME: TStringField;
    cdsStandardValuesSTANDARDID: TStringField;
    cdsStandardValuesVARIABLEID: TStringField;
    cdsStandardValuesACCEPTEDVALUE: TFloatField;
    cdsStandardValuesSTANDARDNAME: TStringField;
    qVarVar: TSQLQuery;
    dspVarVar: TDataSetProvider;
    cdsVarVar: TClientDataSet;
    dsVarVar: TDataSource;
    qVarVarVARIABLEID: TStringField;
    qVarVarVARIABLENAME: TStringField;
    cdsVarVarVARIABLEID: TStringField;
    cdsVarVarVARIABLENAME: TStringField;
    qStandardValuesVARIABLENAME: TStringField;
    cdsStandardValuesVARIABLENAME: TStringField;
    dsQdmSmpDB: TDataSource;
    qVarRegTypes: TSQLQuery;
    qVarReg: TSQLQuery;
    qSmpDataX: TSQLQuery;
    qVarRegTypesVARREGTYPEID: TStringField;
    qVarRegTypesVARREGTYPE: TStringField;
    qVarRegISOSYSTEM: TStringField;
    qVarRegVARREGTYPEID: TStringField;
    qVarRegVARIABLEID: TStringField;
    dspVarRegTypes: TDataSetProvider;
    dspVarReg: TDataSetProvider;
    cdsVarRegTypes: TClientDataSet;
    cdsVarReg: TClientDataSet;
    dsVarRegTypes: TDataSource;
    dsVarReg: TDataSource;
    cdsVarRegTypesVARREGTYPEID: TStringField;
    cdsVarRegTypesVARREGTYPE: TStringField;
    cdsVarRegISOSYSTEM: TStringField;
    cdsVarRegVARREGTYPEID: TStringField;
    cdsVarRegVARIABLEID: TStringField;
    cdsSmpDataSTANDARDVALUE: TFloatField;
    cdsSmpDataX: TClientDataSet;
    dsSmpDataX: TDataSource;
    qSmpDataXerr: TSQLQuery;
    cdsSmpDataXerr: TClientDataSet;
    dsSmpDataXerr: TDataSource;
    cdsQdmSmpqSmpDataXerr: TDataSetField;
    cdsSmpDataXerrVARIABLEID: TStringField;
    cdsSmpDataXerrDATAVALUE: TFloatField;
    cdsSmpDataXerrNORMALISINGSTANDARD: TStringField;
    cdsSmpDataXerrSTANDARDVALUE: TFloatField;
    cdsSmpDataXerrVARIABLENAME: TStringField;
    dspQdmSmp: TDataSetProvider;
    qStandardValueX: TSQLQuery;
    dsqSmpDataX: TDataSource;
    cdsAcceptedValueX: TClientDataSet;
    dsAcceptedValueX: TDataSource;
    qSmpDataY: TSQLQuery;
    dsqSmpDataY: TDataSource;
    cdsSmpDataY: TClientDataSet;
    StringField1: TStringField;
    FloatField1: TFloatField;
    StringField2: TStringField;
    FloatField2: TFloatField;
    StringField3: TStringField;
    StringField4: TStringField;
    StringField5: TStringField;
    StringField6: TStringField;
    dsSmpDataY: TDataSource;
    qStandardValueY: TSQLQuery;
    cdsAcceptedValueY: TClientDataSet;
    FloatField3: TFloatField;
    dsAcceptedValueY: TDataSource;
    cdsQdmSmpqSmpDataY: TDataSetField;
    qSmpDataYerr: TSQLQuery;
    cdsSmpDataYerr: TClientDataSet;
    StringField8: TStringField;
    FloatField4: TFloatField;
    StringField9: TStringField;
    FloatField5: TFloatField;
    StringField10: TStringField;
    dsSmpDataYerr: TDataSource;
    qSmpDataR: TSQLQuery;
    cdsSmpDataR: TClientDataSet;
    StringField11: TStringField;
    FloatField6: TFloatField;
    StringField12: TStringField;
    FloatField7: TFloatField;
    StringField13: TStringField;
    dsSmpDataR: TDataSource;
    cdsQdmSmpqSmpDataR: TDataSetField;
    cdsQdmSmpqSmpDataYerr: TDataSetField;
    cdsSmpDataXSAMPLENO: TStringField;
    cdsSmpDataXFRAC: TStringField;
    cdsSmpDataXISOSYSTEM: TStringField;
    cdsSmpDataXVARIABLEID: TStringField;
    cdsSmpDataXDATAVALUE: TFloatField;
    cdsSmpDataXNORMALISINGSTANDARD: TStringField;
    cdsSmpDataXSTANDARDVALUE: TFloatField;
    cdsSmpDataXVARIABLENAME: TStringField;
    cdsSmpDataXqStandardValueX: TDataSetField;
    qNormalisedValueX: TSQLQuery;
    cdsNormalisedValueX: TClientDataSet;
    dsNormalisedValueX: TDataSource;
    qNormalisedValueY: TSQLQuery;
    cdsNormalisedValueY: TClientDataSet;
    dsNormalisedValueY: TDataSource;
    cdsAcceptedValueXACCEPTEDVALUE: TFloatField;
    cdsNormalisedValueXNORMALISEDVALUE: TFloatField;
    cdsNormalisedValueYNORMALISEDVALUE: TFloatField;
    qErrTypeX: TSQLQuery;
    cdsErrTypeX: TClientDataSet;
    dsErrTypeX: TDataSource;
    dsqSmpDataXerr: TDataSource;
    qErrTypeY: TSQLQuery;
    cdsErrTypeY: TClientDataSet;
    dsErrTypeY: TDataSource;
    dsqSmpDataYerr: TDataSource;
    qSmpDataPrecX: TSQLQuery;
    cdsSmpDataPrecX: TClientDataSet;
    dsSmpDataPrecX: TDataSource;
    cdsQdmSmpqSmpDataPrecX: TDataSetField;
    cdsSmpDataPrecXVARIABLEID: TStringField;
    cdsSmpDataPrecXDATAVALUE: TFloatField;
    qSmpDataPrecY: TSQLQuery;
    cdsSmpDataPrecY: TClientDataSet;
    StringField7: TStringField;
    FloatField8: TFloatField;
    dsSmpDataPrecY: TDataSource;
    cdsQdmSmpqSmpDataPrecY: TDataSetField;
    qErrTypes: TSQLQuery;
    dspErrTypes: TDataSetProvider;
    cdsErrTypes: TClientDataSet;
    dsErrTypes: TDataSource;
    cdsErrTypesERRORTYPE: TStringField;
    cdsErrTypesDATAVALUE: TFloatField;
    cdsQdmSmpqErrTypeX: TDataSetField;
    cdsErrTypeXVARIABLEID: TStringField;
    cdsErrTypeXDATAVALUE: TFloatField;
    cdsQdmSmpqErrTypeY: TDataSetField;
    cdsErrTypeYVARIABLEID: TStringField;
    cdsErrTypeYDATAVALUE: TFloatField;
    cdsQdmSmpqNormalisedValueY: TDataSetField;
    cdsQdmSmpqNormalisedValueX: TDataSetField;
    qSmpDataZ: TSQLQuery;
    dsqSmpDataZ: TDataSource;
    cdsSmpDataZ: TClientDataSet;
    StringField14: TStringField;
    FloatField9: TFloatField;
    StringField15: TStringField;
    FloatField10: TFloatField;
    StringField16: TStringField;
    StringField17: TStringField;
    StringField18: TStringField;
    StringField19: TStringField;
    dsSmpDataZ: TDataSource;
    qStandardValueZ: TSQLQuery;
    cdsAcceptedValueZ: TClientDataSet;
    FloatField11: TFloatField;
    dsAcceptedValueZ: TDataSource;
    qNormalisedValueZ: TSQLQuery;
    cdsNormalisedValueZ: TClientDataSet;
    FloatField12: TFloatField;
    dsNormalisedValueZ: TDataSource;
    qSmpDataPrecZ: TSQLQuery;
    cdsSmpDataPrecZ: TClientDataSet;
    StringField20: TStringField;
    FloatField13: TFloatField;
    dsSmpDataPrecZ: TDataSource;
    qSmpDataZerr: TSQLQuery;
    cdsSmpDataZerr: TClientDataSet;
    StringField21: TStringField;
    FloatField14: TFloatField;
    StringField22: TStringField;
    FloatField15: TFloatField;
    StringField23: TStringField;
    dsSmpDataZerr: TDataSource;
    qErrTypeZ: TSQLQuery;
    cdsErrTypeZ: TClientDataSet;
    StringField24: TStringField;
    FloatField16: TFloatField;
    dsErrTypeZ: TDataSource;
    cdsQdmSmpqErrTypeZ: TDataSetField;
    cdsQdmSmpqSmpDataZerr: TDataSetField;
    cdsQdmSmpqSmpDataPrecZ: TDataSetField;
    cdsQdmSmpqNormalisedValueZ: TDataSetField;
    cdsQdmSmpqSmpDataZ: TDataSetField;
    cdsSmpDataZqStandardValueZ: TDataSetField;
    QuerydmUNITID: TIntegerField;
    cdsQuerydmUNITID: TIntegerField;
    qSamplesWithData: TSQLQuery;
    dspSamplesWithData: TDataSetProvider;
    cdsSamplesWithData: TClientDataSet;
    dsSamplesWithData: TDataSource;
    cdsSamplesWithDataSAMPLENO: TStringField;
    qRawSmp: TSQLQuery;
    dsqRawSmp: TDataSource;
    dspRawSmp: TDataSetProvider;
    cdsRawSmp: TClientDataSet;
    dsRawSmp: TDataSource;
    qRawDataX: TSQLQuery;
    dsqRawDataX: TDataSource;
    cdsRawDataX: TClientDataSet;
    dsRawDataX: TDataSource;
    qRawStandardValueX: TSQLQuery;
    cdsRawStandardValueX: TClientDataSet;
    dsRawStandardValueX: TDataSource;
    qRawNormalisedValueX: TSQLQuery;
    cdsRawNormalisedValueX: TClientDataSet;
    dsRawNormalisedValueX: TDataSource;
    qRawDataXerr: TSQLQuery;
    dsqRawDataXerr: TDataSource;
    cdsRawDataXerr: TClientDataSet;
    dsRawDataXerr: TDataSource;
    qRawErrTypeX: TSQLQuery;
    cdsRawErrTypeX: TClientDataSet;
    dsRawErrTypeX: TDataSource;
    qRawDataPrecX: TSQLQuery;
    cdsRawDataPrecX: TClientDataSet;
    dsRawDataPrecX: TDataSource;
    qRawDataY: TSQLQuery;
    dsqRawDataY: TDataSource;
    cdsRawDataY: TClientDataSet;
    dsRawDataY: TDataSource;
    qRawStandardValueY: TSQLQuery;
    cdsRawStandardValueY: TClientDataSet;
    dsRawStandardValueY: TDataSource;
    qRawNormalisedValueY: TSQLQuery;
    cdsRawNormalisedValueY: TClientDataSet;
    dsRawNormalisedValueY: TDataSource;
    qRawDataYerr: TSQLQuery;
    dsqRawDataYerr: TDataSource;
    cdsRawDataYerr: TClientDataSet;
    dsRawDataYerr: TDataSource;
    qRawErrTypeY: TSQLQuery;
    cdsRawErrTypeY: TClientDataSet;
    dsRawErrTypeY: TDataSource;
    qRawDataPrecY: TSQLQuery;
    cdsRawDataPrecY: TClientDataSet;
    dsRawDataPrecY: TDataSource;
    qRawDataR: TSQLQuery;
    cdsRawDataR: TClientDataSet;
    qRawDataZ: TSQLQuery;
    dsqRawDataZ: TDataSource;
    cdsRawDataZ: TClientDataSet;
    dsRawDataZ: TDataSource;
    dsRawDataR: TDataSource;
    qRawStandardValueZ: TSQLQuery;
    cdsRawStandardValueZ: TClientDataSet;
    dsRawStandardValueZ: TDataSource;
    qRawNormalisedValueZ: TSQLQuery;
    cdsRawNormalisedValueZ: TClientDataSet;
    dsRawNormalisedValueZ: TDataSource;
    qRawDataZerr: TSQLQuery;
    cdsRawDataZerr: TClientDataSet;
    dsRawDataZerr: TDataSource;
    qRawErrTypeZ: TSQLQuery;
    cdsRawErrTypeZ: TClientDataSet;
    dsRawErrTypeZ: TDataSource;
    qRawDataPrecZ: TSQLQuery;
    cdsRawDataPrecZ: TClientDataSet;
    dsRawDataPrecZ: TDataSource;
    cdsRawSmpSAMPLENO: TStringField;
    cdsRawSmpFRAC: TStringField;
    cdsRawSmpqRawDataXerr: TDataSetField;
    cdsRawSmpqRawDataX: TDataSetField;
    cdsRawSmpqRawDataR: TDataSetField;
    cdsRawSmpqRawErrTypeY: TDataSetField;
    cdsRawSmpqRawErrTypeZ: TDataSetField;
    cdsRawSmpqRawNormalisedValueZ: TDataSetField;
    cdsRawSmpqRawNormalisedValueY: TDataSetField;
    cdsRawSmpqRawDataPrecZ: TDataSetField;
    cdsRawSmpqRawDataZerr: TDataSetField;
    cdsRawSmpqRawDataZ: TDataSetField;
    cdsRawSmpqRawDataPrecY: TDataSetField;
    cdsRawSmpqRawDataYerr: TDataSetField;
    cdsRawSmpqRawDataY: TDataSetField;
    cdsRawSmpqRawDataPrecX: TDataSetField;
    cdsRawSmpqRawNormalisedValueX: TDataSetField;
    cdsRawDataXSAMPLENO: TStringField;
    cdsRawDataXFRAC: TStringField;
    cdsRawDataXISOSYSTEM: TStringField;
    cdsRawDataXVARIABLEID: TStringField;
    cdsRawDataXDATAVALUE: TFloatField;
    cdsRawDataXNORMALISINGSTANDARD: TStringField;
    cdsRawDataXSTANDARDVALUE: TFloatField;
    cdsRawDataXVARIABLENAME: TStringField;
    cdsRawDataXqRawStandardValueX: TDataSetField;
    cdsRawStandardValueXACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueXSAMPLENO: TStringField;
    cdsRawNormalisedValueXFRAC: TStringField;
    cdsRawNormalisedValueXISOSYSTEM: TStringField;
    cdsRawNormalisedValueXVARIABLEID: TStringField;
    cdsRawNormalisedValueXDATAVALUE: TFloatField;
    cdsRawNormalisedValueXNORMALISINGSTANDARD: TStringField;
    cdsRawNormalisedValueXSTANDARDVALUE: TFloatField;
    cdsRawNormalisedValueXACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueXNORMALISEDVALUE: TFloatField;
    cdsRawSmpqRawErrTypeX: TDataSetField;
    cdsRawErrTypeXSAMPLENO: TStringField;
    cdsRawErrTypeXFRAC: TStringField;
    cdsRawErrTypeXISOSYSTEM: TStringField;
    cdsRawErrTypeXVARIABLEID: TStringField;
    cdsRawErrTypeXDATAVALUE: TFloatField;
    cdsRawErrTypeXNORMALISINGSTANDARD: TStringField;
    cdsRawErrTypeXSTANDARDVALUE: TFloatField;
    cdsRawErrTypeXVARIABLENAME: TStringField;
    cdsRawDataYSAMPLENO: TStringField;
    cdsRawDataYFRAC: TStringField;
    cdsRawDataYISOSYSTEM: TStringField;
    cdsRawDataYVARIABLEID: TStringField;
    cdsRawDataYDATAVALUE: TFloatField;
    cdsRawDataYNORMALISINGSTANDARD: TStringField;
    cdsRawDataYSTANDARDVALUE: TFloatField;
    cdsRawDataYVARIABLENAME: TStringField;
    cdsRawDataYqRawStandardValueY: TDataSetField;
    cdsRawStandardValueYACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueYSAMPLENO: TStringField;
    cdsRawNormalisedValueYFRAC: TStringField;
    cdsRawNormalisedValueYISOSYSTEM: TStringField;
    cdsRawNormalisedValueYVARIABLEID: TStringField;
    cdsRawNormalisedValueYDATAVALUE: TFloatField;
    cdsRawNormalisedValueYNORMALISINGSTANDARD: TStringField;
    cdsRawNormalisedValueYSTANDARDVALUE: TFloatField;
    cdsRawNormalisedValueYACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueYNORMALISEDVALUE: TFloatField;
    cdsRawDataYerrSAMPLENO: TStringField;
    cdsRawDataYerrFRAC: TStringField;
    cdsRawDataYerrISOSYSTEM: TStringField;
    cdsRawDataYerrVARIABLEID: TStringField;
    cdsRawDataYerrDATAVALUE: TFloatField;
    cdsRawDataYerrNORMALISINGSTANDARD: TStringField;
    cdsRawDataYerrSTANDARDVALUE: TFloatField;
    cdsRawDataYerrVARIABLENAME: TStringField;
    cdsRawErrTypeYSAMPLENO: TStringField;
    cdsRawErrTypeYFRAC: TStringField;
    cdsRawErrTypeYISOSYSTEM: TStringField;
    cdsRawErrTypeYVARIABLEID: TStringField;
    cdsRawErrTypeYDATAVALUE: TFloatField;
    cdsRawErrTypeYNORMALISINGSTANDARD: TStringField;
    cdsRawErrTypeYSTANDARDVALUE: TFloatField;
    cdsRawErrTypeYVARIABLENAME: TStringField;
    cdsRawDataPrecYSAMPLENO: TStringField;
    cdsRawDataPrecYFRAC: TStringField;
    cdsRawDataPrecYISOSYSTEM: TStringField;
    cdsRawDataPrecYVARIABLEID: TStringField;
    cdsRawDataPrecYDATAVALUE: TFloatField;
    cdsRawDataRSAMPLENO: TStringField;
    cdsRawDataRFRAC: TStringField;
    cdsRawDataRISOSYSTEM: TStringField;
    cdsRawDataRVARIABLEID: TStringField;
    cdsRawDataRDATAVALUE: TFloatField;
    cdsRawDataRNORMALISINGSTANDARD: TStringField;
    cdsRawDataRSTANDARDVALUE: TFloatField;
    cdsRawDataRVARIABLENAME: TStringField;
    cdsRawDataZSAMPLENO: TStringField;
    cdsRawDataZFRAC: TStringField;
    cdsRawDataZISOSYSTEM: TStringField;
    cdsRawDataZVARIABLEID: TStringField;
    cdsRawDataZDATAVALUE: TFloatField;
    cdsRawDataZNORMALISINGSTANDARD: TStringField;
    cdsRawDataZSTANDARDVALUE: TFloatField;
    cdsRawDataZVARIABLENAME: TStringField;
    cdsRawDataZqRawStandardValueZ: TDataSetField;
    cdsRawStandardValueZACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueZSAMPLENO: TStringField;
    cdsRawNormalisedValueZFRAC: TStringField;
    cdsRawNormalisedValueZISOSYSTEM: TStringField;
    cdsRawNormalisedValueZVARIABLEID: TStringField;
    cdsRawNormalisedValueZDATAVALUE: TFloatField;
    cdsRawNormalisedValueZNORMALISINGSTANDARD: TStringField;
    cdsRawNormalisedValueZSTANDARDVALUE: TFloatField;
    cdsRawNormalisedValueZACCEPTEDVALUE: TFloatField;
    cdsRawNormalisedValueZNORMALISEDVALUE: TFloatField;
    cdsRawDataZerrSAMPLENO: TStringField;
    cdsRawDataZerrFRAC: TStringField;
    cdsRawDataZerrISOSYSTEM: TStringField;
    cdsRawDataZerrVARIABLEID: TStringField;
    cdsRawDataZerrDATAVALUE: TFloatField;
    cdsRawDataZerrNORMALISINGSTANDARD: TStringField;
    cdsRawDataZerrSTANDARDVALUE: TFloatField;
    cdsRawDataZerrVARIABLENAME: TStringField;
    cdsRawErrTypeZSAMPLENO: TStringField;
    cdsRawErrTypeZFRAC: TStringField;
    cdsRawErrTypeZISOSYSTEM: TStringField;
    cdsRawErrTypeZVARIABLEID: TStringField;
    cdsRawErrTypeZDATAVALUE: TFloatField;
    cdsRawErrTypeZNORMALISINGSTANDARD: TStringField;
    cdsRawErrTypeZSTANDARDVALUE: TFloatField;
    cdsRawErrTypeZVARIABLENAME: TStringField;
    cdsRawDataPrecZSAMPLENO: TStringField;
    cdsRawDataPrecZFRAC: TStringField;
    cdsRawDataPrecZISOSYSTEM: TStringField;
    cdsRawDataPrecZVARIABLEID: TStringField;
    cdsRawDataPrecZDATAVALUE: TFloatField;
    cdsData: TClientDataSet;
    dsData: TDataSource;
    cdsDataSampleNo: TStringField;
    cdsDataFrac: TStringField;
    cdsDataPb207U235: TFloatField;
    cdsDataPb207U235Sigma: TFloatField;
    cdsDataPb206U238: TFloatField;
    cdsDataU238Pb206: TFloatField;
    cdsDataU238Pb206Sigma: TFloatField;
    cdsDataPb207Pb206: TFloatField;
    cdsDataPb207Pb206Sigma: TFloatField;
    cdsDataIncludeYN: TStringField;
    cdsDataPb206U238Sigma: TFloatField;
    qRawDiscordance: TSQLQuery;
    cdsRawDiscordance: TClientDataSet;
    dsRawDiscordance: TDataSource;
    qRawAgePref: TSQLQuery;
    cdsRawAgePref: TClientDataSet;
    dsRawAgePref: TDataSource;
    dsqRawAgePref: TDataSource;
    qRawDataAgeerr: TSQLQuery;
    dsqRawDataAgeerr: TDataSource;
    cdsRawDataAgeerr: TClientDataSet;
    dsRawDataAgeerr: TDataSource;
    cdsRawSmpqRawAgePref: TDataSetField;
    cdsRawSmpqRawDiscordance: TDataSetField;
    cdsRawDiscordanceSAMPLENO: TStringField;
    cdsRawDiscordanceFRAC: TStringField;
    cdsRawDiscordanceISOSYSTEM: TStringField;
    cdsRawDiscordanceVARIABLEID: TStringField;
    cdsRawDiscordanceDATAVALUE: TFloatField;
    cdsRawAgePrefSAMPLENO: TStringField;
    cdsRawAgePrefFRAC: TStringField;
    cdsRawAgePrefISOSYSTEM: TStringField;
    cdsRawAgePrefVARIABLEID: TStringField;
    cdsRawAgePrefDATAVALUE: TFloatField;
    cdsRawAgePrefqRawDataAgeerr: TDataSetField;
    cdsRawDataAgeerrSAMPLENO: TStringField;
    cdsRawDataAgeerrFRAC: TStringField;
    cdsRawDataAgeerrISOSYSTEM: TStringField;
    cdsRawDataAgeerrVARIABLEID: TStringField;
    cdsRawDataAgeerrDATAVALUE: TFloatField;
    cdsRawDataAgeerrNORMALISINGSTANDARD: TStringField;
    cdsRawDataAgeerrSTANDARDVALUE: TFloatField;
    cdsRawDataAgeerrVARIABLENAME: TStringField;
    cdsDataPercentConcordance: TFloatField;
    cdsDataPreferredAge: TFloatField;
    cdsDataPreferredAgeSigma: TFloatField;
    cdsRawDataXerrSAMPLENO: TStringField;
    cdsRawDataXerrFRAC: TStringField;
    cdsRawDataXerrISOSYSTEM: TStringField;
    cdsRawDataXerrVARIABLEID: TStringField;
    cdsRawDataXerrDATAVALUE: TFloatField;
    cdsRawDataXerrNORMALISINGSTANDARD: TStringField;
    cdsRawDataXerrSTANDARDVALUE: TFloatField;
    cdsRawDataXerrVARIABLENAME: TStringField;
    cdsRawDataPrecXSAMPLENO: TStringField;
    cdsRawDataPrecXFRAC: TStringField;
    cdsRawDataPrecXISOSYSTEM: TStringField;
    cdsRawDataPrecXVARIABLEID: TStringField;
    cdsRawDataPrecXDATAVALUE: TFloatField;
    cdsPDF: TClientDataSet;
    cdsPDFStep: TIntegerField;
    cdsPDFPDFDataValue: TFloatField;
    cdsPDFPDFValue: TFloatField;
    dsPDF: TDataSource;
    cdsPeaksFound: TClientDataSet;
    dsPeaksFound: TDataSource;
    cdsPeaksFoundi: TIntegerField;
    cdsPeaksFoundAge: TFloatField;
    cdsPeaksFoundAgePlus95: TFloatField;
    cdsPeaksFoundAgeMinus95: TFloatField;
    cdsPeaksFoundProbability: TFloatField;
    qRawRef: TSQLQuery;
    cdsRawRef: TClientDataSet;
    dsRawRef: TDataSource;
    cdsRawSmpqRawRef: TDataSetField;
    cdsRawRefSAMPLENO: TStringField;
    cdsRawRefREFNUM: TIntegerField;
    cdsRawRefSOURCESHORT: TStringField;
    qRawSmpLoc: TSQLQuery;
    cdsRawSmpLoc: TClientDataSet;
    dsRawSmpLoc: TDataSource;
    cdsRawSmpqRawSmpLoc: TDataSetField;
    cdsRawSmpLocCOUNTRYABR: TStringField;
    cdsRawSmpLocCONTINENTID: TStringField;
    cdsRawSmpLocLONGITUDE: TFloatField;
    cdsRawSmpLocLATITUDE: TFloatField;
    cdsRawSmpLocELEVATION: TFloatField;
    dsDataHf: TDataSource;
    cdsDataHf: TClientDataSet;
    cdsDataHfSampleNo: TStringField;
    cdsDataHfFrac: TStringField;
    cdsDataHfEpsilon: TFloatField;
    cdsDataHfEpsilonSigma: TFloatField;
    cdsDataHfPreferredAge: TFloatField;
    cdsDataHfPreferredAgeSigma: TFloatField;
    cdsDataHfIncludeYN: TStringField;
    cdsDataHfPercentConcordance: TFloatField;
    cdsDataHfTDM: TFloatField;
    cdsDataHfTDMSigma: TFloatField;
    qRawDataDM: TSQLQuery;
    dsqRawDataDM: TDataSource;
    cdsRawDataDM: TClientDataSet;
    dsRawDataDM: TDataSource;
    qRawDataDMerr: TSQLQuery;
    dsqRawDataDMerr: TDataSource;
    cdsRawDataDMerr: TClientDataSet;
    dsRawDataDMerr: TDataSource;
    cdsRawSmpqRawDataDM: TDataSetField;
    cdsRawDataDMSAMPLENO: TStringField;
    cdsRawDataDMFRAC: TStringField;
    cdsRawDataDMISOSYSTEM: TStringField;
    cdsRawDataDMVARIABLEID: TStringField;
    cdsRawDataDMDATAVALUE: TFloatField;
    cdsRawDataDMqRawDataDMerr: TDataSetField;
    cdsRawDataDMerrSAMPLENO: TStringField;
    cdsRawDataDMerrFRAC: TStringField;
    cdsRawDataDMerrISOSYSTEM: TStringField;
    cdsRawDataDMerrVARIABLEID: TStringField;
    cdsRawDataDMerrDATAVALUE: TFloatField;
    cdsRawDataDMerrNORMALISINGSTANDARD: TStringField;
    cdsRawDataDMerrSTANDARDVALUE: TFloatField;
    cdsRawDataDMerrVARIABLENAME: TStringField;
    ReportDataHf: TFlexCelReport;
    qExisting: TSQLQuery;
    dspExisting: TDataSetProvider;
    cdsExisting: TClientDataSet;
    dsExisting: TDataSource;
    cdsExistingRECORDID: TIntegerField;
    cdsExistingCOUNTRYABR: TStringField;
    cdsExistingUNITID: TIntegerField;
    cdsExistingMATERIALABR: TStringField;
    cdsExistingISOTOPESYSTEM: TStringField;
    cdsExistingAPPROACHABR: TStringField;
    cdsExistingTECHABR: TStringField;
    cdsExistingINTERPABR: TStringField;
    cdsExistingRAGE: TFloatField;
    cdsExistingRAGEPERROR: TFloatField;
    cdsExistingRAGEMERROR: TFloatField;
    cdsExistingUNITNAME: TStringField;
    cdsExistingUNITRANK: TStringField;
    cdsExistingCONTINENTID: TStringField;
    cdsExistingMATERIALDESCRIPTION: TStringField;
    cdsExistingAPPROACHDESCRIPTION: TStringField;
    cdsExistingTECHNIQUE: TStringField;
    cdsExistingINTERPRETATION: TStringField;
    qRawDataZSAMPLENO: TStringField;
    qRawDataZFRAC: TStringField;
    qRawDataZISOSYSTEM: TStringField;
    qRawDataZVARIABLEID: TStringField;
    qRawDataZDATAVALUE: TFloatField;
    qRawDataZNORMALISINGSTANDARD: TStringField;
    qRawDataZSTANDARDVALUE: TFloatField;
    qRawDataZVARIABLENAME: TStringField;
    qRawSmpSAMPLENO: TStringField;
    qRawSmpFRAC: TStringField;
    qRawDataXSAMPLENO: TStringField;
    qRawDataXFRAC: TStringField;
    qRawDataXISOSYSTEM: TStringField;
    qRawDataXVARIABLEID: TStringField;
    qRawDataXDATAVALUE: TFloatField;
    qRawDataXNORMALISINGSTANDARD: TStringField;
    qRawDataXSTANDARDVALUE: TFloatField;
    qRawDataXVARIABLENAME: TStringField;
    qRawStandardValueXACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueXSAMPLENO: TStringField;
    qRawNormalisedValueXFRAC: TStringField;
    qRawNormalisedValueXISOSYSTEM: TStringField;
    qRawNormalisedValueXVARIABLEID: TStringField;
    qRawNormalisedValueXDATAVALUE: TFloatField;
    qRawNormalisedValueXNORMALISINGSTANDARD: TStringField;
    qRawNormalisedValueXSTANDARDVALUE: TFloatField;
    qRawNormalisedValueXACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueXNORMALISEDVALUE: TFloatField;
    qRawDataXerrSAMPLENO: TStringField;
    qRawDataXerrFRAC: TStringField;
    qRawDataXerrISOSYSTEM: TStringField;
    qRawDataXerrVARIABLEID: TStringField;
    qRawDataXerrDATAVALUE: TFloatField;
    qRawDataXerrNORMALISINGSTANDARD: TStringField;
    qRawDataXerrSTANDARDVALUE: TFloatField;
    qRawDataXerrVARIABLENAME: TStringField;
    qRawErrTypeXSAMPLENO: TStringField;
    qRawErrTypeXFRAC: TStringField;
    qRawErrTypeXISOSYSTEM: TStringField;
    qRawErrTypeXVARIABLEID: TStringField;
    qRawErrTypeXDATAVALUE: TFloatField;
    qRawErrTypeXNORMALISINGSTANDARD: TStringField;
    qRawErrTypeXSTANDARDVALUE: TFloatField;
    qRawErrTypeXVARIABLENAME: TStringField;
    qRawDataPrecXSAMPLENO: TStringField;
    qRawDataPrecXFRAC: TStringField;
    qRawDataPrecXISOSYSTEM: TStringField;
    qRawDataPrecXVARIABLEID: TStringField;
    qRawDataPrecXDATAVALUE: TFloatField;
    qRawDataYSAMPLENO: TStringField;
    qRawDataYFRAC: TStringField;
    qRawDataYISOSYSTEM: TStringField;
    qRawDataYVARIABLEID: TStringField;
    qRawDataYDATAVALUE: TFloatField;
    qRawDataYNORMALISINGSTANDARD: TStringField;
    qRawDataYSTANDARDVALUE: TFloatField;
    qRawDataYVARIABLENAME: TStringField;
    qRawStandardValueYACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueYSAMPLENO: TStringField;
    qRawNormalisedValueYFRAC: TStringField;
    qRawNormalisedValueYISOSYSTEM: TStringField;
    qRawNormalisedValueYVARIABLEID: TStringField;
    qRawNormalisedValueYDATAVALUE: TFloatField;
    qRawNormalisedValueYNORMALISINGSTANDARD: TStringField;
    qRawNormalisedValueYSTANDARDVALUE: TFloatField;
    qRawNormalisedValueYACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueYNORMALISEDVALUE: TFloatField;
    qRawDataYerrSAMPLENO: TStringField;
    qRawDataYerrFRAC: TStringField;
    qRawDataYerrISOSYSTEM: TStringField;
    qRawDataYerrVARIABLEID: TStringField;
    qRawDataYerrDATAVALUE: TFloatField;
    qRawDataYerrNORMALISINGSTANDARD: TStringField;
    qRawDataYerrSTANDARDVALUE: TFloatField;
    qRawDataYerrVARIABLENAME: TStringField;
    qRawDataRSAMPLENO: TStringField;
    qRawDataRFRAC: TStringField;
    qRawDataRISOSYSTEM: TStringField;
    qRawDataRVARIABLEID: TStringField;
    qRawDataRDATAVALUE: TFloatField;
    qRawDataRNORMALISINGSTANDARD: TStringField;
    qRawDataRSTANDARDVALUE: TFloatField;
    qRawDataRVARIABLENAME: TStringField;
    qRawDataPrecYSAMPLENO: TStringField;
    qRawDataPrecYFRAC: TStringField;
    qRawDataPrecYISOSYSTEM: TStringField;
    qRawDataPrecYVARIABLEID: TStringField;
    qRawDataPrecYDATAVALUE: TFloatField;
    qRawErrTypeYSAMPLENO: TStringField;
    qRawErrTypeYFRAC: TStringField;
    qRawErrTypeYISOSYSTEM: TStringField;
    qRawErrTypeYVARIABLEID: TStringField;
    qRawErrTypeYDATAVALUE: TFloatField;
    qRawErrTypeYNORMALISINGSTANDARD: TStringField;
    qRawErrTypeYSTANDARDVALUE: TFloatField;
    qRawErrTypeYVARIABLENAME: TStringField;
    qRawStandardValueZACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueZSAMPLENO: TStringField;
    qRawNormalisedValueZFRAC: TStringField;
    qRawNormalisedValueZISOSYSTEM: TStringField;
    qRawNormalisedValueZVARIABLEID: TStringField;
    qRawNormalisedValueZDATAVALUE: TFloatField;
    qRawNormalisedValueZNORMALISINGSTANDARD: TStringField;
    qRawNormalisedValueZSTANDARDVALUE: TFloatField;
    qRawNormalisedValueZACCEPTEDVALUE: TFloatField;
    qRawNormalisedValueZNORMALISEDVALUE: TFloatField;
    qRawDataZerrSAMPLENO: TStringField;
    qRawDataZerrFRAC: TStringField;
    qRawDataZerrISOSYSTEM: TStringField;
    qRawDataZerrVARIABLEID: TStringField;
    qRawDataZerrDATAVALUE: TFloatField;
    qRawDataZerrNORMALISINGSTANDARD: TStringField;
    qRawDataZerrSTANDARDVALUE: TFloatField;
    qRawDataZerrVARIABLENAME: TStringField;
    qRawErrTypeZSAMPLENO: TStringField;
    qRawErrTypeZFRAC: TStringField;
    qRawErrTypeZISOSYSTEM: TStringField;
    qRawErrTypeZVARIABLEID: TStringField;
    qRawErrTypeZDATAVALUE: TFloatField;
    qRawErrTypeZNORMALISINGSTANDARD: TStringField;
    qRawErrTypeZSTANDARDVALUE: TFloatField;
    qRawErrTypeZVARIABLENAME: TStringField;
    qRawDataPrecZSAMPLENO: TStringField;
    qRawDataPrecZFRAC: TStringField;
    qRawDataPrecZISOSYSTEM: TStringField;
    qRawDataPrecZVARIABLEID: TStringField;
    qRawDataPrecZDATAVALUE: TFloatField;
    qRawDataDMSAMPLENO: TStringField;
    qRawDataDMFRAC: TStringField;
    qRawDataDMISOSYSTEM: TStringField;
    qRawDataDMVARIABLEID: TStringField;
    qRawDataDMDATAVALUE: TFloatField;
    qRawDiscordanceSAMPLENO: TStringField;
    qRawDiscordanceFRAC: TStringField;
    qRawDiscordanceISOSYSTEM: TStringField;
    qRawDiscordanceVARIABLEID: TStringField;
    qRawDiscordanceDATAVALUE: TFloatField;
    qRawRefSAMPLENO: TStringField;
    qRawRefREFNUM: TIntegerField;
    qRawRefSOURCESHORT: TStringField;
    qRawDataDMerrSAMPLENO: TStringField;
    qRawDataDMerrFRAC: TStringField;
    qRawDataDMerrISOSYSTEM: TStringField;
    qRawDataDMerrVARIABLEID: TStringField;
    qRawDataDMerrDATAVALUE: TFloatField;
    qRawDataDMerrNORMALISINGSTANDARD: TStringField;
    qRawDataDMerrSTANDARDVALUE: TFloatField;
    qRawDataDMerrVARIABLENAME: TStringField;
    qRawAgePrefSAMPLENO: TStringField;
    qRawAgePrefFRAC: TStringField;
    qRawAgePrefISOSYSTEM: TStringField;
    qRawAgePrefVARIABLEID: TStringField;
    qRawAgePrefDATAVALUE: TFloatField;
    qRawSmpLocCOUNTRYABR: TStringField;
    qRawSmpLocCONTINENTID: TStringField;
    qRawSmpLocLONGITUDE: TFloatField;
    qRawSmpLocLATITUDE: TFloatField;
    qRawSmpLocELEVATION: TFloatField;
    qRawDataAgeerrSAMPLENO: TStringField;
    qRawDataAgeerrFRAC: TStringField;
    qRawDataAgeerrISOSYSTEM: TStringField;
    qRawDataAgeerrVARIABLEID: TStringField;
    qRawDataAgeerrDATAVALUE: TFloatField;
    qRawDataAgeerrNORMALISINGSTANDARD: TStringField;
    qRawDataAgeerrSTANDARDVALUE: TFloatField;
    qRawDataAgeerrVARIABLENAME: TStringField;
    qRecalcSmp: TSQLQuery;
    dsqRecalcSmp: TDataSource;
    dspRecalcSmp: TDataSetProvider;
    cdsRecalcSmp: TClientDataSet;
    dsRecalcSmp: TDataSource;
    qRecalcY: TSQLQuery;
    dsqRecalcY: TDataSource;
    cdsRecalcY: TClientDataSet;
    dsRecalcY: TDataSource;
    qRecalcStandardY: TSQLQuery;
    cdsRecalcStandardY: TClientDataSet;
    dsRecalcStandardValueY: TDataSource;
    qRecalcNormalisedY: TSQLQuery;
    cdsRecalcNormalisedY: TClientDataSet;
    dsRecalcNormalisedY: TDataSource;
    qRecalcAgePref: TSQLQuery;
    dsqRecalcAgePref: TDataSource;
    cdsRecalcAgePref: TClientDataSet;
    dsRecalcAgePref: TDataSource;
    qRecalcZ: TSQLQuery;
    dsqRecalcZ: TDataSource;
    cdsRecalcZ: TClientDataSet;
    dsRecalcZ: TDataSource;
    qRecalcSmpSAMPLENO: TStringField;
    qRecalcSmpFRAC: TStringField;
    cdsRecalcSmpSAMPLENO: TStringField;
    cdsRecalcSmpFRAC: TStringField;
    cdsRecalcSmpqRecalcZ: TDataSetField;
    cdsRecalcSmpqRecalcAgePref: TDataSetField;
    cdsRecalcSmpqRecalcNormalisedY: TDataSetField;
    cdsRecalcSmpqRecalcY: TDataSetField;
    qRecalcYSAMPLENO: TStringField;
    qRecalcYFRAC: TStringField;
    qRecalcYISOSYSTEM: TStringField;
    qRecalcYVARIABLEID: TStringField;
    qRecalcYDATAVALUE: TFloatField;
    qRecalcYNORMALISINGSTANDARD: TStringField;
    qRecalcYSTANDARDVALUE: TFloatField;
    qRecalcYVARIABLENAME: TStringField;
    cdsRecalcYSAMPLENO: TStringField;
    cdsRecalcYFRAC: TStringField;
    cdsRecalcYISOSYSTEM: TStringField;
    cdsRecalcYVARIABLEID: TStringField;
    cdsRecalcYDATAVALUE: TFloatField;
    cdsRecalcYNORMALISINGSTANDARD: TStringField;
    cdsRecalcYSTANDARDVALUE: TFloatField;
    cdsRecalcYVARIABLENAME: TStringField;
    cdsRecalcYqRecalcStandardY: TDataSetField;
    qRecalcStandardYACCEPTEDVALUE: TFloatField;
    qRecalcNormalisedYSAMPLENO: TStringField;
    qRecalcNormalisedYFRAC: TStringField;
    qRecalcNormalisedYISOSYSTEM: TStringField;
    qRecalcNormalisedYVARIABLEID: TStringField;
    qRecalcNormalisedYDATAVALUE: TFloatField;
    qRecalcNormalisedYNORMALISINGSTANDARD: TStringField;
    qRecalcNormalisedYSTANDARDVALUE: TFloatField;
    qRecalcNormalisedYACCEPTEDVALUE: TFloatField;
    qRecalcNormalisedYNORMALISEDVALUE: TFloatField;
    cdsRecalcNormalisedYSAMPLENO: TStringField;
    cdsRecalcNormalisedYFRAC: TStringField;
    cdsRecalcNormalisedYISOSYSTEM: TStringField;
    cdsRecalcNormalisedYVARIABLEID: TStringField;
    cdsRecalcNormalisedYDATAVALUE: TFloatField;
    cdsRecalcNormalisedYNORMALISINGSTANDARD: TStringField;
    cdsRecalcNormalisedYSTANDARDVALUE: TFloatField;
    cdsRecalcNormalisedYACCEPTEDVALUE: TFloatField;
    cdsRecalcNormalisedYNORMALISEDVALUE: TFloatField;
    qRecalcAgePrefSAMPLENO: TStringField;
    qRecalcAgePrefFRAC: TStringField;
    qRecalcAgePrefISOSYSTEM: TStringField;
    qRecalcAgePrefVARIABLEID: TStringField;
    qRecalcAgePrefDATAVALUE: TFloatField;
    cdsRecalcAgePrefSAMPLENO: TStringField;
    cdsRecalcAgePrefFRAC: TStringField;
    cdsRecalcAgePrefISOSYSTEM: TStringField;
    cdsRecalcAgePrefVARIABLEID: TStringField;
    cdsRecalcAgePrefDATAVALUE: TFloatField;
    cdsRecalcZSAMPLENO: TStringField;
    cdsRecalcZFRAC: TStringField;
    cdsRecalcZISOSYSTEM: TStringField;
    cdsRecalcZVARIABLEID: TStringField;
    cdsRecalcZDATAVALUE: TFloatField;
    cdsRecalcZNORMALISINGSTANDARD: TStringField;
    cdsRecalcZSTANDARDVALUE: TFloatField;
    cdsRecalcZVARIABLENAME: TStringField;
    cdsDatatRec: TIntegerField;
    cdsInitials: TClientDataSet;
    dsInitials: TDataSource;
    cdsInitialsInitial: TFloatField;
    cdsInitialsInitialError: TFloatField;
    cdsInitialsEpsilon: TFloatField;
    cdsInitialsEpsilonError: TFloatField;
    cdsInitialsSampleNo: TStringField;
    cdsInitialsFrac: TStringField;
    cdsInitialsi: TIntegerField;
    cdsInitialsAge: TFloatField;
    cdsInitialsAgePlus95: TFloatField;
    cdsInitialsAgeMinus95: TFloatField;
    qNew: TSQLQuery;
    cdsDataHfYmodeli: TFloatField;
    cdsInitialsYmodeli: TFloatField;
    cdsDataHfInitRatio: TFloatField;
    cdsDataHfInitRatioSigma: TFloatField;
    cdsDataHf176Lu177Hf: TFloatField;
    cdsDataHf176Lu177HfSigma: TFloatField;
    cdsDataHf176Hf177Hf: TFloatField;
    cdsDataHf176Hf177HfSigma: TFloatField;
    cdsDataHfyes: TClientDataSet;
    dsDataHfyes: TDataSource;
    cdsDataHfyesSampleNo: TStringField;
    cdsDataHfyesFrac: TStringField;
    cdsDataHfyesEpsilon: TFloatField;
    cdsDataHfyesEpsilonSigma: TFloatField;
    cdsDataHfyesPreferredAge: TFloatField;
    cdsDataHfyesPreferredAgeSigma: TFloatField;
    cdsDataHfyesIncludeYN: TStringField;
    cdsDataHfyesPercentConcordance: TFloatField;
    cdsDataHfyesTDM: TFloatField;
    cdsDataHfyesTDMSigma: TFloatField;
    cdsDataHfyesYmodeli: TFloatField;
    cdsDataHfyesInitRatio: TFloatField;
    cdsDataHfyesInitRatioSigma: TFloatField;
    cdsDataHfyes176Lu177Hf: TFloatField;
    cdsDataHfyes176Lu177HfSigma: TFloatField;
    cdsDataHfyes176Hf177Hf: TFloatField;
    cdsDataHfyes176Hf177HfSigma: TFloatField;
    cdsDataHfi: TIntegerField;
    ReportDataUPb: TFlexCelReport;
    qRawDataInclude: TSQLQuery;
    cdsRawDataInclude: TClientDataSet;
    dsRawDataInclude: TDataSource;
    cdsRawSmpqRawDataInclude: TDataSetField;
    qRawDataIncludeSAMPLENO: TStringField;
    qRawDataIncludeFRAC: TStringField;
    qRawDataIncludeISOSYSTEM: TStringField;
    qRawDataIncludeVARIABLEID: TStringField;
    qRawDataIncludeDATAVALUE: TFloatField;
    cdsRawDataIncludeSAMPLENO: TStringField;
    cdsRawDataIncludeFRAC: TStringField;
    cdsRawDataIncludeISOSYSTEM: TStringField;
    cdsRawDataIncludeVARIABLEID: TStringField;
    cdsRawDataIncludeDATAVALUE: TFloatField;
    cdsPeaks: TClientDataSet;
    dsPeaks: TDataSource;
    cdsPeaksPeakStep: TIntegerField;
    cdsPeaksPeakAge: TFloatField;
    cdsPeaksPeakValue: TFloatField;
    cdsPeaksPeakChange: TFloatField;
    qRecalcX: TSQLQuery;
    StringField25: TStringField;
    StringField26: TStringField;
    StringField27: TStringField;
    StringField28: TStringField;
    FloatField17: TFloatField;
    StringField29: TStringField;
    FloatField18: TFloatField;
    StringField30: TStringField;
    dsqRecalcX: TDataSource;
    cdsRecalcX: TClientDataSet;
    dsRecalcX: TDataSource;
    qRecalcStandardX: TSQLQuery;
    FloatField21: TFloatField;
    cdsRecalcStandardX: TClientDataSet;
    dsRecalcStandardValueX: TDataSource;
    qRecalcNormalisedX: TSQLQuery;
    StringField37: TStringField;
    StringField38: TStringField;
    StringField39: TStringField;
    StringField40: TStringField;
    FloatField22: TFloatField;
    StringField41: TStringField;
    FloatField23: TFloatField;
    FloatField24: TFloatField;
    FloatField25: TFloatField;
    cdsRecalcNormalisedX: TClientDataSet;
    dsRecalcNormalisedX: TDataSource;
    cdsRecalcSmpqRecalcNormalisedX: TDataSetField;
    cdsRecalcSmpqRecalcX: TDataSetField;
    cdsRecalcXqRecalcStandardX: TDataSetField;
    qRecalcDM: TSQLQuery;
    dsqRecalcDM: TDataSource;
    cdsRecalcDM: TClientDataSet;
    dsRecalcDM: TDataSource;
    cdsRecalcSmpqRecalcDM: TDataSetField;
    cdsRecalcDMSAMPLENO: TStringField;
    cdsRecalcDMFRAC: TStringField;
    cdsRecalcDMISOSYSTEM: TStringField;
    cdsRecalcDMVARIABLEID: TStringField;
    cdsRecalcDMDATAVALUE: TFloatField;
    cdsRecalcDMNORMALISINGSTANDARD: TStringField;
    cdsRecalcDMSTANDARDVALUE: TFloatField;
    cdsRecalcDMVARIABLENAME: TStringField;
    cdsRecalcNormalisedXSAMPLENO: TStringField;
    cdsRecalcNormalisedXFRAC: TStringField;
    cdsRecalcNormalisedXISOSYSTEM: TStringField;
    cdsRecalcNormalisedXVARIABLEID: TStringField;
    cdsRecalcNormalisedXDATAVALUE: TFloatField;
    cdsRecalcNormalisedXNORMALISINGSTANDARD: TStringField;
    cdsRecalcNormalisedXSTANDARDVALUE: TFloatField;
    cdsRecalcNormalisedXACCEPTEDVALUE: TFloatField;
    cdsRecalcNormalisedXNORMALISEDVALUE: TFloatField;
    cdsRecalcXSAMPLENO: TStringField;
    cdsRecalcXFRAC: TStringField;
    cdsRecalcXISOSYSTEM: TStringField;
    cdsRecalcXVARIABLEID: TStringField;
    cdsRecalcXDATAVALUE: TFloatField;
    cdsRecalcXNORMALISINGSTANDARD: TStringField;
    cdsRecalcXSTANDARDVALUE: TFloatField;
    cdsRecalcXVARIABLENAME: TStringField;
    dsRecalcInit: TDataSource;
    cdsRecalcInit: TClientDataSet;
    dsqRecalcInit: TDataSource;
    qRecalcInit: TSQLQuery;
    cdsRecalcSmpqRecalcInit: TDataSetField;
    cdsRecalcInitSAMPLENO: TStringField;
    cdsRecalcInitFRAC: TStringField;
    cdsRecalcInitISOSYSTEM: TStringField;
    cdsRecalcInitVARIABLEID: TStringField;
    cdsRecalcInitDATAVALUE: TFloatField;
    cdsRecalcInitNORMALISINGSTANDARD: TStringField;
    cdsRecalcInitSTANDARDVALUE: TFloatField;
    cdsRecalcInitVARIABLENAME: TStringField;
    qRecalcDMSAMPLENO: TStringField;
    qRecalcDMFRAC: TStringField;
    qRecalcDMISOSYSTEM: TStringField;
    qRecalcDMVARIABLEID: TStringField;
    qRecalcDMDATAVALUE: TFloatField;
    qRecalcDMNORMALISINGSTANDARD: TStringField;
    qRecalcDMSTANDARDVALUE: TFloatField;
    qRecalcDMVARIABLENAME: TStringField;
    qRecalcInitSAMPLENO: TStringField;
    qRecalcInitFRAC: TStringField;
    qRecalcInitISOSYSTEM: TStringField;
    qRecalcInitVARIABLEID: TStringField;
    qRecalcInitDATAVALUE: TFloatField;
    qRecalcInitNORMALISINGSTANDARD: TStringField;
    qRecalcInitSTANDARDVALUE: TFloatField;
    qRecalcInitVARIABLENAME: TStringField;
    qRecalcZSAMPLENO: TStringField;
    qRecalcZFRAC: TStringField;
    qRecalcZISOSYSTEM: TStringField;
    qRecalcZVARIABLEID: TStringField;
    qRecalcZDATAVALUE: TFloatField;
    qRecalcZNORMALISINGSTANDARD: TStringField;
    qRecalcZSTANDARDVALUE: TFloatField;
    qRecalcZVARIABLENAME: TStringField;
    qUpdateData: TSQLQuery;
    XLSXAdapter1: TXLSXAdapter;
    qVarVarISOTOPESYSTEM: TStringField;
    cdsVarVarISOTOPESYSTEM: TStringField;
    cdsQdmSmpqSmpDataX: TDataSetField;
    cdsNormalisedValueYSAMPLENO: TStringField;
    cdsNormalisedValueYFRAC: TStringField;
    cdsNormalisedValueYISOSYSTEM: TStringField;
    cdsNormalisedValueYVARIABLEID: TStringField;
    cdsNormalisedValueYDATAVALUE: TFloatField;
    cdsNormalisedValueYNORMALISINGSTANDARD: TStringField;
    cdsNormalisedValueYSTANDARDVALUE: TFloatField;
    cdsNormalisedValueYACCEPTEDVALUE: TFloatField;
    cdsSmpDataYqStandardValueY: TDataSetField;
    cdsTable1test: TStringField;
    SQLMonitor1: TSQLMonitor;
    qRawSmpLocLITHOLOGY: TStringField;
    qRawSmpLocLITHCLASS: TStringField;
    cdsRawSmpLocLITHOLOGY: TStringField;
    cdsRawSmpLocLITHCLASS: TStringField;
    cdsDataChem: TClientDataSet;
    cdsDataChemi: TIntegerField;
    cdsDataChemSampleNo: TStringField;
    cdsDataChemFrac: TStringField;
    cdsDataChemPreferredAge: TFloatField;
    cdsDataChemPreferredAgeSigma: TFloatField;
    cdsDataChemPercentConcordance: TFloatField;
    cdsDataChemIncludeYN: TStringField;
    dsDataChem: TDataSource;
    cdsDataChemVar1: TFloatField;
    cdsDataChemVar1Sigma: TFloatField;
    cdsDataChemVar2: TFloatField;
    cdsDataChemVar2Sigma: TFloatField;
    cdsDataChemVar3: TFloatField;
    cdsDataChemVar3Sigma: TFloatField;
    qRawSmpREGASSOCID: TStringField;
    cdsRawSmpREGASSOCID: TStringField;
    qRecalcSmpREGASSOCID: TStringField;
    cdsRecalcSmpREGASSOCID: TStringField;
    qSmpDataXSAMPLENO: TStringField;
    qSmpDataXFRAC: TStringField;
    qSmpDataXISOSYSTEM: TStringField;
    qSmpDataXVARIABLEID: TStringField;
    qSmpDataXDATAVALUE: TFloatField;
    qSmpDataXNORMALISINGSTANDARD: TStringField;
    qSmpDataXSTANDARDVALUE: TFloatField;
    qSmpDataXVARIABLENAME: TStringField;
    qSmpDataXREGASSOCID: TStringField;
    cdsSmpDataXREGASSOCID: TStringField;
    qRecalcSmpISOSYSTEM: TStringField;
    cdsRecalcSmpISOSYSTEM: TStringField;
    qRawAgePrefREGASSOCID: TStringField;
    cdsRawAgePrefREGASSOCID: TStringField;
    qRawDataZREGASSOCID: TStringField;
    cdsRawDataZREGASSOCID: TStringField;
    qRawDataYREGASSOCID: TStringField;
    cdsRawDataYREGASSOCID: TStringField;
    qRawDataXREGASSOCID: TStringField;
    cdsRawDataXREGASSOCID: TStringField;
    qRawDataDMREGASSOCID: TStringField;
    cdsRawDataDMREGASSOCID: TStringField;
    cdsDataZoneID: TStringField;
    cdsDataHfZoneID: TStringField;
    cdsDataHfyesZoneID: TStringField;
    cdsDataChemZoneID: TStringField;
  private
    { Private declarations }
  public
    { Public declarations }
    procedure CalculateConcordiaForAge(Age : double; var t207235 : double;
                                  var t206238 : double; var t207206 : double;
                                  var t238206 : double);
    procedure ConstructRawDataSampleQuery;
    procedure SubmitNewIsoInitRecord(tRecordID : integer;
                                     tAge, tInitial, tInitialError,
                                     tEpsilon, tEpsilonError : double;
                                 var WasSuccessful : boolean);
    function DM_Age(tx, ty, DC, MP1, MP2, MP3, AgeTolerance : double) : double;
    function DM_Age_Error(tx, ty, txe, tye, TMult, DC, MP1, MP2, MP3, AgeTolerance : double) : double;
    procedure UpdateSmpData(tSampleNo,tFrac,tIsoSystem,tVariableID,tTechAbr : string;
                            RevisedDataValue : double;
                        var WasSuccessful : boolean);
  end;

// Procs
  function dmdDV: TdmdDV;

implementation
{$R *.dfm}

uses
  IWInit,
  ServerController,
  DVIW_constants, usrIW_dm;


function dmdDV: TdmdDV;
begin
  Result := TUserSession(WebApplication.Data).dmdDV;
end;

procedure TdmdDV.CalculateConcordiaForAge(Age : double; var t207235 : double;
                                  var t206238 : double; var t207206 : double;
                                  var t238206 : double);
const
  DecayConst235U = 9.8485e-10;
  DecayConst238U = 1.55125e-10;
  Constant238235 = 137.88;
begin
  t207235 := Exp(DecayConst235U*Age)-1.0;
  t206238 := Exp(DecayConst238U*Age)-1.0;
  if (Age > 0.00001) then t207206 := (1.0/Constant238235) * (t207235/t206238)
                     else t207206 := 0.046045;
  if (t206238 > 0.0) then  t238206 := 1.0/t206238
                     else t238206 := 0.0;
end;

procedure TdmdDV.ConstructRawDataSampleQuery;
var
  i : integer;
begin
{
SELECT DISTINCT SMPDATA.SAMPLENO, SMPDATA.FRAC,
SMPDATA.ISOSYSTEM
FROM SMPDATA,SMPLOC
WHERE SMPDATA.SAMPLENO=SMPLOC.SAMPLENO
AND (SMPDATA.ISOSYSTEM=:IsotopeSystem
OR SMPDATA.ISOSYSTEM='NA')
ORDER BY SMPDATA.SAMPLENO, SMPDATA.FRAC
}
  dmdDV.qRawSmp.Close;
  dmdDV.qRawSmp.SQL.Clear;
  dmdDV.qRawSmp.SQL.Add('SELECT DISTINCT SMPDATA.SAMPLENO, SMPDATA.FRAC,');
  dmdDV.qRawSmp.SQL.Add('VARREGASSOC.REGASSOCID');
  dmdDV.qRawSmp.SQL.Add('FROM SMPDATA,SMPLOC,VARREGASSOC');
  if (UserSession.IncludeTerraneValues) then
  begin
    dmdDV.qRawSmp.SQL.Add(',SMPREG,ISOPROVTERR');
  end;
  dmdDV.qRawSmp.SQL.Add('WHERE SMPDATA.SAMPLENO=SMPLOC.SAMPLENO');
  dmdDV.qRawSmp.SQL.Add('AND VARREGASSOC.REGASSOCID=:RegAssocID');
  //dmdDV.qRawSmp.SQL.Add('AND (SMPDATA.ISOSYSTEM=:IsotopeSystem');
  //if ((UserSession.UnitSender = usIndividualAgeChem) or (UserSession.UnitSender = usMultipleAgeChem))
  //then dmdDV.qRawSmp.SQL.Add('OR SMPDATA.ISOSYSTEM='+''''+'UPb'+'''');
  //dmdDV.qRawSmp.SQL.Add('OR SMPDATA.ISOSYSTEM='+''''+'NA'+''''+')');
  if (UserSession.IncludeSampleValues and (UserSession.SampleValues.Count=0)) then
  begin
    UserSession.IncludeSampleValues := false;
  end;
  if (UserSession.IncludeContinentValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('AND ( SMPLOC.CONTINENTID = '+''''+UserSession.ContinentValues.Strings[0]+'''');
    if (UserSession.ContinentValues.Count >1) then
    begin
      for i := 2 to UserSession.ContinentValues.Count do
      begin
        dmdDV.qRawSmp.SQL.Add('OR SMPLOC.CONTINENTID = '+''''+UserSession.ContinentValues.Strings[i-1]+'''');
      end;
    end;
    dmdDV.qRawSmp.SQL.Add(' ) ');
  end;
  if (UserSession.IncludeAreaValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('AND ( SMPLOC.COUNTRYABR = '+''''+UserSession.AreaValues.Strings[0]+'''');
    if (UserSession.AreaValues.Count >1) then
    begin
      for i := 2 to UserSession.AreaValues.Count do
      begin
        dmdDV.qRawSmp.SQL.Add('OR SMPLOC.COUNTRYABR = '+''''+UserSession.AreaValues.Strings[i-1]+'''');
      end;
    end;
    dmdDV.qRawSmp.SQL.Add(' ) ');
  end;
  if (UserSession.IncludeSampleValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('AND ( SMPDATA.SAMPLENO = '+''''+UserSession.SampleValues.Strings[0]+'''');
    if (UserSession.SampleValues.Count >1) then
    begin
      for i := 2 to UserSession.SampleValues.Count do
      begin
        dmdDV.qRawSmp.SQL.Add('OR SMPDATA.SAMPLENO = '+''''+UserSession.SampleValues.Strings[i-1]+'''');
      end;
    end;
    dmdDV.qRawSmp.SQL.Add(' ) ');
  end;
  if (not UserSession.IncludeSampleValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('AND SMPDATA.SAMPLENO >= '+''''+UserSession.SampleStartFrom+'''');
    dmdDV.qRawSmp.SQL.Add('AND SMPDATA.SAMPLENO <= '+''''+UserSession.SampleEndWith+'''');
  end;
  if (UserSession.IncludeReferenceValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('AND ( SMPDATA.REFNUM = '+''''+UserSession.ReferenceValues.Strings[0]+'''');
    if (UserSession.ReferenceValues.Count >1) then
    begin
      for i := 2 to UserSession.ReferenceValues.Count do
      begin
        dmdDV.qRawSmp.SQL.Add('OR SMPDATA.REFNUM = '+''''+UserSession.ReferenceValues.Strings[i-1]+'''');
      end;
    end;
    dmdDV.qRawSmp.SQL.Add(' ) ');
  end;
  if UserSession.IncludeCoordinates then
  begin
    dmdDV.qRawSmp.SQL.Add('AND SMPLOC.LATITUDE <= 90.0');
    dmdDV.qRawSmp.SQL.Add('AND SMPLOC.LATITUDE <= '+UserSession.NELat);
    dmdDV.qRawSmp.SQL.Add('AND SMPLOC.LONGITUDE <= '+UserSession.NELon);
    dmdDV.qRawSmp.SQL.Add('AND SMPLOC.LATITUDE >= '+UserSession.SWLat);
    dmdDV.qRawSmp.SQL.Add('AND SMPLOC.LONGITUDE >= '+UserSession.SWLon);
  end;
  if (UserSession.IncludeTerraneValues) then
  begin
    dmdDV.qRawSmp.SQL.Add('and smpreg.sampleno=smploc.sampleno');
    dmdDV.qRawSmp.SQL.Add('and smpreg.recordid=isoprovterr.recordid');
    //dmdDV.qRawSmp.SQL.Add('and smpreg.recordid=isoprovterr.recordid');
    dmdDV.qRawSmp.SQL.Add('AND ( ISOPROVTERR.DOMAINID = '+''''+UserSession.TerraneValues.Strings[0]+'''');
    if (UserSession.TerraneValues.Count >1) then
    begin
      for i := 2 to UserSession.TerraneValues.Count do
      begin
        dmdDV.qRawSmp.SQL.Add('OR ISOPROVTERR.DOMAINID = '+''''+UserSession.TerraneValues.Strings[i-1]+'''');
      end;
    end;
    dmdDV.qRawSmp.SQL.Add(' ) ');
  end;
  dmdDV.qRawSmp.SQL.Add('ORDER BY SMPDATA.SAMPLENO, SMPDATA.FRAC');
  //dmUser.SetDeveloperData('qRawSmp construct');
  //dmUser.SetDeveloperData(dmdDV.qRawSmp.SQL.Text);
end;

procedure TdmdDV.SubmitNewIsoInitRecord(tRecordID : integer;
                                        tAge, tInitial, tInitialError,
                                        tEpsilon, tEpsilonError : double;
                                        var WasSuccessful : boolean);
const
  zero = 0;
var
  TD: TDBXTransaction;
  tFullAge, tempinitialage,
  tempinitial, tempinitialerror,
  tempepsilon, tempepsilonerror : double;
begin
  UserSession.WhereAmI := 'NewIsoInitRecord start';
  try
    UserSession.WhereAmI := 'Start Insert new isoinit record';
    dmdDV.qNew.SQL.Clear;
    dmdDV.qNew.SQL.Add('INSERT INTO ISOINIT');
    dmdDV.qNew.SQL.Add('(RECORDID, INITRATIO, INITRATIOERROR, EPSILON, EPSILONERROR)');
    dmdDV.qNew.SQL.Add('VALUES ('+IntToStr(tRecordID)+', '+FormatFloat('###0.000000',tinitial)+', ');
    dmdDV.qNew.SQL.Add(FormatFloat('###0.000000',tinitialerror)+', ');
    dmdDV.qNew.SQL.Add(FormatFloat('####0.0000',tepsilon)+', ');
    dmdDV.qNew.SQL.Add(FormatFloat('####0.0000',tepsilonerror)+')');
    //dmUser.SetDeveloperData(dmdDV.qNew.SQL.Text);
    if not dmdDV.sqlcDateView.InTransaction then
    begin
      TD := dmdDV.sqlcDateView.BeginTransaction(TDBXIsolations.ReadCommitted);
      try
        dmdDV.qNew.ExecSQL(false);
        dmdDV.sqlcDateView.CommitFreeAndNil(TD); //on success, commit the changes
        WasSuccessful := true;
      except
        dmdDV.sqlcDateView.RollbackFreeAndNil(TD); //on failure, undo the changes
        WasSuccessful := false;
      end;
    end;
  except
  end;
  UserSession.WhereAmI := 'NewIsoInitRecord end';
end;

function TdmdDV.DM_Age(tx, ty, DC, MP1, MP2, MP3, AgeTolerance : double) : double;
const
  MaxIterations = 50;
var
  i                  : integer;
  temp, temp1       : double;
  DMX1, DMY1, DMY2, Difference,
  AgeMax, ApproxAge :  double;
  ThisDone          :  Boolean;
begin
  if (MP3 > 0.0) then
  begin
    if (MP1 <> 0.0) then
    begin
      ThisDone := false;
      i := 0;
      AgeMax := 4.60E9;
      repeat
        DMX1 := ty-tx*(Exp(DC*AgeMax)-1.0);
        DMY1 := MP1*(AgeMax)*(AgeMax)
            + MP2*(AgeMax)
            + MP3;
        DMY2 := (MP2)+tx*DC *(Exp(DC*AgeMax));
        DMY2 := DMY2+2.0*MP1*AgeMax;
        DMY1 := DMY1-DMX1;
        if (DMY2 <> 0.0) then
          ApproxAge := AgeMax-DMY1/DMY2
        else begin
          ApproxAge := 1.0e6;
          i := MaxIterations + 1;
        end;
        Difference := Abs(AgeMax-ApproxAge);
        AgeMax := ApproxAge;
        i := i+1;
        if (Difference < AgeTolerance) then ThisDone := true;
        if (i > MaxIterations) then
        begin
          AgeMax := 9999.0E6;
          ThisDone := true;
        end;
      until ThisDone;
    end;
    if ((MP1 = 0.0) and (MP2 > 0.0)) then
    begin
      temp := ((ty-MP3)/(tx-MP2) + 1.0);
      if (temp>0.0) then temp1 := ln(temp)
                    else temp1 := 0.0;
      AgeMax := (temp1/DC);
    end;
    DM_Age := AgeMax/1.0E6;
  end else
  begin
    DM_Age := 9999.99;
  end;
end;


function TdmdDV.DM_Age_Error(tx, ty, txe, tye, TMult, DC, MP1, MP2, MP3, AgeTolerance : double) : double;
var
  tage, tplus1,
  tminus1,
  t1, t2    : double;
begin
  t1 := txe;
  t2 := tye;
  if (t1 <= 0.0) then t1 := 1.0e-5;
  if (t2 <= 0.0) then t2 := 1.0e-5;
  tage := dmdDV.DM_Age(tx,ty,DC,MP1,MP2,MP3,AgeTolerance);
  tplus1 := dmdDV.DM_Age(tx+t1*TMult,ty+t2*TMult,DC,MP1,MP2,MP3,AgeTolerance);
  tminus1 := dmdDV.DM_Age(tx-t1*TMult,ty-t2*TMult,DC,MP1,MP2,MP3,AgeTolerance);
  DM_Age_Error := Sqrt(((tplus1-tage)*(tplus1-tage)+(tage-tminus1)*(tage-tminus1))+0.000001);
end;


procedure TdmdDV.UpdateSmpData(tSampleNo,tFrac,tIsoSystem,tVariableID,tTechAbr : string;
                               RevisedDataValue : double;
                           var WasSuccessful : boolean);
const
  zero = 0;
var
  TD: TDBXTransaction;
begin
  UserSession.WhereAmI := 'Start UpdateSmpData start';
  //try
    UserSession.WhereAmI := 'Start Update SMPDATA';
    dmdDV.qUpdateData.SQL.Clear;
    dmdDV.qUpdateData.SQL.Add('UPDATE SMPDATA');
    dmdDV.qUpdateData.SQL.Add('SET SMPDATA.DATAVALUE = '+FormatFloat('######.#######',RevisedDataValue));
    dmdDV.qUpdateData.SQL.Add('WHERE SMPDATA.SAMPLENO = '+quotedstr(tSampleNo));
    dmdDV.qUpdateData.SQL.Add('AND SMPDATA.FRAC = '+quotedstr(tFrac));
    dmdDV.qUpdateData.SQL.Add('AND SMPDATA.ISOSYSTEM = '+quotedstr(tIsoSystem));
    dmdDV.qUpdateData.SQL.Add('AND SMPDATA.VARIABLEID = '+quotedstr(tVariableID));
    //dmdDV.qUpdateData.SQL.Add('AND SMPDATA.TECHABR = '+quotedstr(tTechAbr));
    //dmUser.SetDeveloperData(dmdDV.qUpdateData.SQL.Text);
      TD := dmdDV.sqlcDateView.BeginTransaction(TDBXIsolations.ReadCommitted);
      try
        dmdDV.qUpdateData.ExecSQL(false);
        dmdDV.sqlcDateView.CommitFreeAndNil(TD); //on success, commit the changes
        WasSuccessful := true;
      except
        dmdDV.sqlcDateView.RollbackFreeAndNil(TD); //on failure, undo the changes
        WasSuccessful := false;
      end;
  //except
  //end;
  UserSession.WhereAmI := 'UpdateSmpData end';
end;




end.
